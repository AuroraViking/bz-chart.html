<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Real-Time Bz Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      background-color: black;
    }
    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <canvas id="bzChart"></canvas>
  <script>
    const ctx = document.getElementById('bzChart').getContext('2d');
    let bzChart;

    async function fetchData() {
      try {
        const response = await fetch('https://services.swpc.noaa.gov/products/solar-wind/mag-2-hour.json');
        const data = await response.json();
        const rows = data.slice(1); // Skip headers
        const times = rows.map(entry => entry[0].substring(11, 16));
        const bzValues = rows.map(entry => parseFloat(entry[3]));

        return { times, bzValues };
      } catch (error) {
        console.error('Error fetching data:', error);
        return { times: [], bzValues: [] };
      }
    }

    function createChart(times, bzValues) {
      bzChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: times,
          datasets: [{
            label: 'IMF Bz (nT)',
            data: bzValues,
            fill: true,
            backgroundColor: 'rgba(255, 255, 255, 0.1)',
            borderColor: 'white',
            pointRadius: 2,
            segment: {
              borderColor: ctx => ctx.p0.parsed.y < 0 ? 'gold' : 'white'
            }
          }]
        },
        options: {
          scales: {
            x: {
              ticks: { color: 'white' },
              grid: { color: 'gray' }
            },
            y: {
              min: -20,
              max: 20,
              ticks: { stepSize: 5, color: 'white' },
              grid: { color: 'gray' }
            }
          },
          plugins: {
            legend: { labels: { color: 'white' } }
          }
        }
      });
    }

    async function updateChart() {
      const { times, bzValues } = await fetchData();
      if (bzChart) {
        bzChart.data.labels = times;
        bzChart.data.datasets[0].data = bzValues;
        bzChart.update();
      } else {
        createChart(times, bzValues);
      }
    }

    // Initial load
    updateChart();

    // Update every 5 minutes
    setInterval(updateChart, 5 * 60 * 1000);
  </script>
</body>
</html>
